[{"id":"42cf2a1b.a5b9c4","type":"tab","label":"MAP"},{"id":"d7e53ff3.39e67","type":"tab","label":"Balance/Transaction"},{"id":"540c37ca.a66028","type":"tab","label":"Copy of VR"},{"id":"358f4f87.0edb8","type":"tab","label":"VR"},{"id":"8fb10fb2.5d2bf","type":"tab","label":"Back-up"},{"id":"c236c1a.2f0144","type":"websocket-listener","z":"","path":"/ws/map","wholemsg":"false"},{"id":"95c67ae1.95e948","type":"websocket-listener","path":"/ws/stations","wholemsg":"false"},{"id":"ce0a0ba4.c46088","type":"websocket-listener","path":"/ws/audio","wholemsg":"false"},{"id":"d9df3e13.e7661","type":"websocket-listener","z":"","path":"/ws/map","wholemsg":"false"},{"id":"f78c719a.fb06f","type":"websocket-listener","path":"/ws/stations","wholemsg":"false"},{"id":"798e141.dd694ec","type":"websocket-listener","z":"","path":"/ws/map","wholemsg":"false"},{"id":"66f0f4cf.0633ec","type":"websocket-listener","z":"","path":"/ws/stations","wholemsg":"false"},{"id":"8bbade7b.169af","type":"websocket-listener","z":"","path":"/ws/map","wholemsg":"false"},{"id":"8d4cbf47.72f24","type":"websocket-listener","path":"/ws/stations","wholemsg":"false"},{"id":"a5e060c3.a9f78","type":"websocket-listener","z":"","path":"/ws/map","wholemsg":"false"},{"id":"261a5627.9d158a","type":"websocket-listener","z":"","path":"/ws/locs","wholemsg":"false"},{"id":"85391cca.8266d","type":"google-api-config","z":""},{"id":"db799bec.baf5d8","type":"inject","z":"42cf2a1b.a5b9c4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1004.8178176879883,"y":694.5564765930176,"wires":[["c8b85e1d.886e"]]},{"id":"c8b85e1d.886e","type":"function","z":"42cf2a1b.a5b9c4","name":"prepforAPIcall getBanks","func":"\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\" 70ce2fe532664019b4ba950f48e1fd3e\"\n    };\n\n\n// msg.payload  = {\"tablename\":\"Input data\", \n// \"header\":[\"customerID\",\"gender\",\"SeniorCitizen\",\"Partner\",\"Dependents\",\"tenure\",\"PhoneService\",\"MultipleLines\",\"InternetService\",\"OnlineSecurity\",\"OnlineBackup\",\"DeviceProtection\",\"TechSupport\",\"StreamingTV\",\"StreamingMovies\",\"Contract\",\"PaperlessBilling\",\"PaymentMethod\",\"MonthlyCharges\",\"TotalCharges\",\"Churn\",\"SampleWeight\"], \n// \"data\":[[\"5919-TMRGD\",\"Female\",\"0\",\"No\",\"Yes\",\"1\",\"Yes\",\"No\",\"Fiber optic\",\"No\",\"No\",\"No\",\"No\",\"Yes\",\"No\",\"Month-to-month\",\"Yes\",\"Electronic check\",79.350,79.350,\"Yes\",1.000]]\n// };\n \n\n\nreturn msg;","outputs":1,"noerr":0,"x":455.8080749511719,"y":726.8811206817627,"wires":[["e7ca4bfe.81f138"]]},{"id":"e7ca4bfe.81f138","type":"http request","z":"42cf2a1b.a5b9c4","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks","tls":"","x":704.5221977233887,"y":768.6304941177368,"wires":[["f71443f0.e98d1"]]},{"id":"f71443f0.e98d1","type":"switch","z":"42cf2a1b.a5b9c4","name":"if BANK ID returned","property":"payload.banks[0].id","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","outputs":2,"x":391.2803955078125,"y":904.3904323577881,"wires":[[],["6540a9b3.4cddb8","1e9a5820.ad90a8"]]},{"id":"1e9a5820.ad90a8","type":"debug","z":"42cf2a1b.a5b9c4","name":"bankid","active":false,"console":"false","complete":"true","x":722.6748809814453,"y":873.3336420059204,"wires":[]},{"id":"6540a9b3.4cddb8","type":"function","z":"42cf2a1b.a5b9c4","name":"prepforAPIcall SPECIFIC bank id","func":"\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"70ce2fe532664019b4ba950f48e1fd3e\",\n    \"Auth-Provider-Name\":\"devuser\",\n    \"Auth-ID\":\"123456789\"\n    };\n\nmsg.bankid  = msg.payload.banks[0].id; \n// msg.payload  = {\"tablename\":\"Input data\", \n// \"header\":[\"customerID\",\"gender\",\"SeniorCitizen\",\"Partner\",\"Dependents\",\"tenure\",\"PhoneService\",\"MultipleLines\",\"InternetService\",\"OnlineSecurity\",\"OnlineBackup\",\"DeviceProtection\",\"TechSupport\",\"StreamingTV\",\"StreamingMovies\",\"Contract\",\"PaperlessBilling\",\"PaymentMethod\",\"MonthlyCharges\",\"TotalCharges\",\"Churn\",\"SampleWeight\"], \n// \"data\":[[\"5919-TMRGD\",\"Female\",\"0\",\"No\",\"Yes\",\"1\",\"Yes\",\"No\",\"Fiber optic\",\"No\",\"No\",\"No\",\"No\",\"Yes\",\"No\",\"Month-to-month\",\"Yes\",\"Electronic check\",79.350,79.350,\"Yes\",1.000]]\n// };\n \n\n\nreturn msg;","outputs":1,"noerr":0,"x":299.30108642578125,"y":1056.6752071380615,"wires":[["95c02f7d.2938d","90904cb4.5cce5","44620693.ecba78"]]},{"id":"95c02f7d.2938d","type":"debug","z":"42cf2a1b.a5b9c4","name":"","active":true,"console":"false","complete":"payload.banks[0].full_name","x":806.388916015625,"y":1018.2222900390625,"wires":[]},{"id":"d8b7e323.e5058","type":"debug","z":"42cf2a1b.a5b9c4","name":"ACCOUNT DETAILS","active":false,"console":"false","complete":"payload.balance.amount","x":791.7116928100586,"y":1370.28870677948,"wires":[]},{"id":"783759c0.24c168","type":"http request","z":"42cf2a1b.a5b9c4","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts/{{accountid}}/{{viewid}}/account","tls":"","x":576.5121231079102,"y":1494.3445649147034,"wires":[["d8b7e323.e5058"]]},{"id":"62ced789.e5d438","type":"function","z":"42cf2a1b.a5b9c4","name":"prpforAPIcall SPECIFIC account and bank and view id","func":"msg.accountid = msg.payload.accounts[0].id;\nmsg.viewid = msg.payload.accounts[0].views_available[0].id;\nmsg.bankid = msg.payload.accounts[0].bank_id;\n\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"26150fd04c3c482bb95af58fc47bf462\",\n    \"Auth-Provider-Name\":\"03310909626700\",\n    \"Auth-ID\":\"123456789\"\n    };\nreturn msg;","outputs":1,"noerr":0,"x":362.68656158447266,"y":1315.9211158752441,"wires":[["783759c0.24c168"]]},{"id":"39bf826e.b6fcde","type":"json","z":"42cf2a1b.a5b9c4","name":"","x":417.4456787109375,"y":1216.921169757843,"wires":[["62ced789.e5d438"]]},{"id":"90904cb4.5cce5","type":"http request","z":"42cf2a1b.a5b9c4","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts","tls":"","x":304.9456787109375,"y":1159.171169757843,"wires":[["39bf826e.b6fcde"]]},{"id":"44620693.ecba78","type":"http request","z":"42cf2a1b.a5b9c4","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/atms","tls":"","x":656.1661434173584,"y":1157.8786373138428,"wires":[["ebfc6c7a.3a6da","2201aeb1.040002","5ea76c59.d976f4"]]},{"id":"ebfc6c7a.3a6da","type":"debug","z":"42cf2a1b.a5b9c4","name":"atms","active":true,"console":"false","complete":"payload","x":1025.8051834106445,"y":1077.7924394607544,"wires":[]},{"id":"f433cb7.3279638","type":"function","z":"42cf2a1b.a5b9c4","name":"get map on one atm","func":"var dist, latt,longg, min = 10000;\nfor(var i = 0;i<124;i++){\n    \n}\n    //msg.lat = msg.payload.atms[pos].location.latitude;    \n    //msg.lon = msg.payload.atms[pos].location.longitude;\n    \n    var po = global.get(\"foo\");\nmsg.payload = {\"lat\": \"msg.lat\", \"lon\": \"msg.lon\", \"var\":po};\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.1904296875,"y":1185.4518280029297,"wires":[["12715e8a.909c91","c96b4a21.1e8e88"]]},{"id":"65e6937e.4b3cec","type":"debug","z":"42cf2a1b.a5b9c4","name":"lat lon","active":false,"console":"false","complete":"payload","x":1623.920986175537,"y":1091.5899066925049,"wires":[]},{"id":"12715e8a.909c91","type":"template","z":"42cf2a1b.a5b9c4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <style>\n       #map {\n        height: 400px;\n        width: 100%;\n       }\n    </style>\n  </head>\n  <body>\n    <h3>My Google Maps Demo</h3>\n    <div id=\"map\"></div>\n    <script>\n\n    var lat = 34;\n\n    var lng = 45;\n      function initMap() {\n        var uluru = {lat:lat, lng: lng};\n        var map = new google.maps.Map(document.getElementById('map'), {\n          zoom: 4,\n          center: uluru\n        });\n        var marker = new google.maps.Marker({\n          position: uluru,\n          map: map\n        });\n      }\n    </script>\n    <script async defer\n    src=\"https://maps.googleapis.com/maps/api/js?key= AIzaSyDEu36gOfXSmEKkIAw3iDfFR5vnleZQ_f4 &callback=initMap\">\n    </script>\n  </body>\n</html>","x":1630.6562767028809,"y":1186.7539010047913,"wires":[["5d984b6.16e0bb4"]]},{"id":"5d984b6.16e0bb4","type":"debug","z":"42cf2a1b.a5b9c4","name":"","active":false,"console":"false","complete":"payload","x":1564.2033958435059,"y":1323.0043258666992,"wires":[]},{"id":"2201aeb1.040002","type":"function","z":"42cf2a1b.a5b9c4","name":"","func":"for(var i = 0;i<124;i++){\n    if(msg.payload.atms[i].address.postcode === \"2311\")\n        return msg;\n}\n","outputs":1,"noerr":0,"x":788.1526145935059,"y":1243.6534633636475,"wires":[["aaf1d76a.929d08"]]},{"id":"aaf1d76a.929d08","type":"debug","z":"42cf2a1b.a5b9c4","name":"","active":false,"console":"false","complete":"payload.atms.address.postcode","x":1080.2076568603516,"y":1347.0802941322327,"wires":[]},{"id":"c96b4a21.1e8e88","type":"debug","z":"42cf2a1b.a5b9c4","name":"","active":false,"console":"false","complete":"payload","x":1434.5336151123047,"y":1225.3867168426514,"wires":[]},{"id":"ca66f68a.a1bbb8","type":"template","z":"42cf2a1b.a5b9c4","name":"mine","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <title>ATM map BOC</title>\n    <style>\n      html, body, #map-canvas {\n        height: 100%;\n        margin: 0px;\n        padding: 0px\n      }\n    </style>\n    <script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyDm6NA--KwnCV_1FofO46AMeQkxD-22ROs&ampcallback=initMap\"></script>\n    <script>\n        \n        function degreesToRadians(degrees) {\n          return degrees * Math.PI / 180;\n        }\n        \n        function distanceInKmBetweenEarthCoordinates(lat1, lon1, lat2, lon2) {\n          var earthRadiusKm = 6371;\n        \n          var dLat = degreesToRadians(lat2-lat1);\n          var dLon = degreesToRadians(lon2-lon1);\n        \n          lat1 = degreesToRadians(lat1);\n          lat2 = degreesToRadians(lat2);\n        \n          var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n                  Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); \n          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n          return earthRadiusKm * c;\n        }\n\t\tfunction initialize() {\n\n\t\t  var myLatlng = new google.maps.LatLng(35.1856,33.3823);\n\t\t  var mapOptions = {\n\t\t    zoom: 8,\n\t\t    center: myLatlng\n\t\t  };\n\t\t  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);\n\t\t  var  infoWindow = new google.maps.InfoWindow;\n          var dist=100;\t\t  \n\n\t\t  if (navigator.geolocation) {\n              navigator.geolocation.getCurrentPosition(function(position) {\n                pos = {\n                  lat: position.coords.latitude,\n                  lng: position.coords.longitude\n                };\n               // global.set(\"pos\",pos);\n                infoWindow.setPosition(pos);\n                infoWindow.setContent('My Location !');\n                infoWindow.open(map);\n                map.setCenter(pos);\n              }, function() {\n                handleLocationError(true, infoWindow, map.getCenter());\n              });\n\t\t  }\n\n\t\t  \n\t\t  /*if (navigator.geolocation) {\n              console.log('Geolocation is supported!');\n              var startPos;\n              var geoSuccess = function(position) {\n                startPos = position;\n                console.log(startPos);\n                \n                var image = 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png';\n                var markerLoc = new google.maps.Marker({\n        \t\t\tposition: new google.maps.LatLng(startPos.coords.latitude,startPos.coords.longitude),\n        \t\t\tmap: map,\n        \t\t\ticon: image,\n        \t\t\tanimation: google.maps.Animation.DROP,\n        \t\t\ttitle: \"My location\"\n        \t    });\n              };\n              navigator.geolocation.getCurrentPosition(geoSuccess);\n              \n            }\n            else {\n                console.log('Geolocation is not supported for this Browser/OS.');\n            }*/\n\n\t\t  var loc = window.location;\n          if (loc.protocol === \"https:\") {\n            newUri = \"wss:\";\n          } else {\n            newUri = \"ws:\";\n          }\n          newUri += \"//\" + loc.host + \"/ws/locs\";\n\t\t  // check for Geolocation support\n\t\t \n\n          \n\n\t\t  \n\t\t  var sock = new WebSocket(newUri);\n\t\t  sock.onopen = function(){ \n\t\t    console.log(\"Connected websocket\");\n\t\t    console.log(\"Sending ping..\");\n\t\t\tsock.send(\"Ping!\");\n\t\t    console.log(\"Ping sent..\");\n\t\t  };\n\t\t  sock.onerror = function(){ console.log(\"Websocket error\"); };\n\t\t  sock.onmessage = function(evt){\n\t\t    var stationData = JSON.parse(evt.data);\n\t\t    console.log(stationData.atms);\n\t\t   //var stations = stationData.root.stations[0].station;\n\t\t\tfor(var i = 0; i < stationData.atms.length; i++) {\n\t\t\t \n\t\t\t  var station = stationData.atms[i];\n\t\t\n              var marker = new google.maps.Marker({\n\t\t\t    position: new google.maps.LatLng(station.location.latitude,station.location.longitude),\n\t\t\t    map: map,\n\t\t\t    animation: google.maps.Animation.DROP,\n\t\t\t    title: station.name\n\t\t\t  });\n\t\t\t  //console.log(global.get(\"pos\"));\n\t\t\t  console.log(distanceInKmBetweenEarthCoordinates(pos.lat, pos.lng, station.location.latitude,station.location.longitude));\n\t\t\t  console.log(pos.lat +\",\"+ pos.lng +\",\"+ station.location.latitude +\",\"+ station.location.longitude);\n              var dist2 = distanceInKmBetweenEarthCoordinates(pos.lat, pos.lng, station.location.latitude,station.location.longitude);\n              if(dist > dist2){\n                  dist = dist2;\n              }\n\t\t\t  console.log(\"distance: \" +dist);\n\t\t\t}\n\t\t\t\n\n\t\t\t\n\t\t  };\n\t\t  \n\t\t};\n\t\t\n\t\tgoogle.maps.event.addDomListener(window, 'load', initialize);\n        \n    </script>\n  </head>\n  <body>\n    <div id=\"map-canvas\"></div>\n  </body>\n</html>","x":612.6969604492188,"y":1684.9259033203125,"wires":[[]]},{"id":"857e3328.9eea6","type":"http response","z":"42cf2a1b.a5b9c4","name":"","x":777.6969604492188,"y":1682.9259033203125,"wires":[]},{"id":"e04a8da5.aeb9e","type":"http in","z":"42cf2a1b.a5b9c4","name":"","url":"/map","method":"get","swaggerDoc":"","x":398.69696044921875,"y":1685.9259033203125,"wires":[["b66a3163.35ad2"]]},{"id":"8fdf6cf8.67142","type":"inject","z":"8fb10fb2.5d2bf","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":180.765625,"y":349.54148602485657,"wires":[["463190ee.597fe"]]},{"id":"463190ee.597fe","type":"function","z":"8fb10fb2.5d2bf","name":"prepforAPIcall getBanks","func":"\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\" 70ce2fe532664019b4ba950f48e1fd3e\"\n    };\n\n\n// msg.payload  = {\"tablename\":\"Input data\", \n// \"header\":[\"customerID\",\"gender\",\"SeniorCitizen\",\"Partner\",\"Dependents\",\"tenure\",\"PhoneService\",\"MultipleLines\",\"InternetService\",\"OnlineSecurity\",\"OnlineBackup\",\"DeviceProtection\",\"TechSupport\",\"StreamingTV\",\"StreamingMovies\",\"Contract\",\"PaperlessBilling\",\"PaymentMethod\",\"MonthlyCharges\",\"TotalCharges\",\"Churn\",\"SampleWeight\"], \n// \"data\":[[\"5919-TMRGD\",\"Female\",\"0\",\"No\",\"Yes\",\"1\",\"Yes\",\"No\",\"Fiber optic\",\"No\",\"No\",\"No\",\"No\",\"Yes\",\"No\",\"Month-to-month\",\"Yes\",\"Electronic check\",79.350,79.350,\"Yes\",1.000]]\n// };\n \n\n\nreturn msg;","outputs":1,"noerr":0,"x":566.395191192627,"y":160.51652336120605,"wires":[["9f16e426.848478"]]},{"id":"d82716c1.923bf8","type":"debug","z":"8fb10fb2.5d2bf","name":"bankid","active":false,"console":"false","complete":"payload.banks[0].id","x":962.2841682434082,"y":217.37763786315918,"wires":[]},{"id":"9f16e426.848478","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks","tls":"","x":779.0618782043457,"y":221.3498363494873,"wires":[["d82716c1.923bf8","86d8a7b8.b33dc8"]]},{"id":"33961926.5e7806","type":"function","z":"8fb10fb2.5d2bf","name":"prepforAPIcall SPECIFIC bank id","func":"\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"70ce2fe532664019b4ba950f48e1fd3e\",\n    \"Auth-Provider-Name\":\"devuser\",\n    \"Auth-ID\":\"123456789\"\n    };\n\nmsg.bankid  = msg.payload.banks[0].id; \n// msg.payload  = {\"tablename\":\"Input data\", \n// \"header\":[\"customerID\",\"gender\",\"SeniorCitizen\",\"Partner\",\"Dependents\",\"tenure\",\"PhoneService\",\"MultipleLines\",\"InternetService\",\"OnlineSecurity\",\"OnlineBackup\",\"DeviceProtection\",\"TechSupport\",\"StreamingTV\",\"StreamingMovies\",\"Contract\",\"PaperlessBilling\",\"PaymentMethod\",\"MonthlyCharges\",\"TotalCharges\",\"Churn\",\"SampleWeight\"], \n// \"data\":[[\"5919-TMRGD\",\"Female\",\"0\",\"No\",\"Yes\",\"1\",\"Yes\",\"No\",\"Fiber optic\",\"No\",\"No\",\"No\",\"No\",\"Yes\",\"No\",\"Month-to-month\",\"Yes\",\"Electronic check\",79.350,79.350,\"Yes\",1.000]]\n// };\n \n\n\nreturn msg;","outputs":1,"noerr":0,"x":367.50627517700195,"y":756.2942333221436,"wires":[["10c10d9a.5c52b2","fbfea46f.d5d198","eaf80220.1d538","31551c3.eb588e4","4ba6b5d8.480b7c","8fbedbae.b54aa8","414f2800.c65e18"]]},{"id":"28e381e1.005e0e","type":"debug","z":"8fb10fb2.5d2bf","name":"debug02","active":false,"console":"false","complete":"true","x":962.2841682434082,"y":308.4887218475342,"wires":[]},{"id":"86d8a7b8.b33dc8","type":"switch","z":"8fb10fb2.5d2bf","name":"if BANK ID returned","property":"payload.banks[0].id","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","outputs":2,"x":503.50627517700195,"y":336.9053783416748,"wires":[["28e381e1.005e0e"],["33961926.5e7806","bf5955.5ad106a8"]]},{"id":"c4ce8ed1.b01af","type":"debug","z":"8fb10fb2.5d2bf","name":"bank details","active":false,"console":"false","complete":"true","x":988.1808433532715,"y":364.73328971862793,"wires":[]},{"id":"10c10d9a.5c52b2","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/customer","tls":"","x":777.895191192627,"y":575.766523361206,"wires":[["bc724914.3ed448"]]},{"id":"bc724914.3ed448","type":"debug","z":"8fb10fb2.5d2bf","name":"customerID","active":false,"console":"false","complete":"payload","x":990.895191192627,"y":552.516523361206,"wires":[]},{"id":"bf5955.5ad106a8","type":"debug","z":"8fb10fb2.5d2bf","name":"bankid","active":false,"console":"false","complete":"true","x":800.395191192627,"y":343.01652336120605,"wires":[]},{"id":"fbfea46f.d5d198","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks","tls":"","x":790.284107208252,"y":443.23869132995605,"wires":[["c4ce8ed1.b01af"]]},{"id":"eaf80220.1d538","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/customers/7a542b37a86d189b5dd0b947","tls":"","x":758.395191192627,"y":654.016523361206,"wires":[["cc56f5c2.668ad8"]]},{"id":"cc56f5c2.668ad8","type":"debug","z":"8fb10fb2.5d2bf","name":"customer details","active":false,"console":"false","complete":"payload","x":980.895191192627,"y":652.516523361206,"wires":[]},{"id":"31551c3.eb588e4","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts","tls":"","x":802.395191192627,"y":504.01652336120605,"wires":[["2a5d0baa.054b84"]]},{"id":"4ba6b5d8.480b7c","type":"debug","z":"8fb10fb2.5d2bf","name":"","active":false,"console":"false","complete":"payload","x":725.895191192627,"y":401.51652336120605,"wires":[]},{"id":"8dc80888.935b38","type":"function","z":"8fb10fb2.5d2bf","name":"get Accounts","func":"msg.payload = msg.payload.accounts;\nreturn msg;","outputs":1,"noerr":0,"x":1086.895191192627,"y":467.76652336120605,"wires":[["ec826ce8.a04ce"]]},{"id":"ec826ce8.a04ce","type":"debug","z":"8fb10fb2.5d2bf","name":"ACCOUNTS","active":true,"console":"false","complete":"payload","x":1314.895191192627,"y":462.51652336120605,"wires":[]},{"id":"2a5d0baa.054b84","type":"json","z":"8fb10fb2.5d2bf","name":"","x":938.895191192627,"y":466.76652336120605,"wires":[["8dc80888.935b38"]]},{"id":"8fbedbae.b54aa8","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts","tls":"","x":740.395191192627,"y":759.016523361206,"wires":[["5c6fe012.865c8"]]},{"id":"5c6fe012.865c8","type":"json","z":"8fb10fb2.5d2bf","name":"","x":852.895191192627,"y":816.766523361206,"wires":[["1baa176a.d2b719","8d200d1e.60a5b"]]},{"id":"1baa176a.d2b719","type":"function","z":"8fb10fb2.5d2bf","name":"prpforAPIcall SPECIFIC account and bank and view id","func":"\nmsg.accountid = msg.payload.accounts[0].id;\nmsg.viewid = msg.payload.accounts[0].views_available[0].id;\nmsg.bankid = msg.payload.accounts[0].bank_id;\n\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"26150fd04c3c482bb95af58fc47bf462\",\n    \"Auth-Provider-Name\":\"03310909626700\",\n    \"Auth-ID\":\"123456789\"\n    };\nreturn msg;","outputs":1,"noerr":0,"x":793.895191192627,"y":915.766523361206,"wires":[["6110fd34.2ad734","12bc43aa.73053c","b450471e.0ec088"]]},{"id":"6110fd34.2ad734","type":"debug","z":"8fb10fb2.5d2bf","name":"ONE ACCount ID","active":false,"console":"false","complete":"accountid","x":1106.895191192627,"y":748.516523361206,"wires":[]},{"id":"b450471e.0ec088","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts/{{accountid}}/{{viewid}}/account","tls":"","x":1011.9616355895996,"y":1094.1899185180664,"wires":[["e35bcd1b.bed18","28c3dc1.99d4a24","1abb763c.2ddcfa"]]},{"id":"e35bcd1b.bed18","type":"debug","z":"8fb10fb2.5d2bf","name":"ACCOUNT DETAILS","active":true,"console":"false","complete":"payload","x":1321.3900337219238,"y":876.7417159080505,"wires":[]},{"id":"12bc43aa.73053c","type":"debug","z":"8fb10fb2.5d2bf","name":"ONE View ID","active":false,"console":"false","complete":"viewid","x":1128.395191192627,"y":846.016523361206,"wires":[]},{"id":"30351e05.6857f2","type":"watson-text-to-speech","z":"8fb10fb2.5d2bf","name":"","lang":"en-US","langhidden":"en-US","langcustom":"NoCustomisationSetting","langcustomhidden":"","voice":"en-US_AllisonVoice","voicehidden":"en-US_AllisonVoice","format":"audio/wav","password":"","payload-response":false,"default-endpoint":true,"service-endpoint":"https://stream.watsonplatform.net/text-to-speech/api","x":1577.1431846618652,"y":1489.848575592041,"wires":[["4de6af9e.8021c"]]},{"id":"28c3dc1.99d4a24","type":"switch","z":"8fb10fb2.5d2bf","name":"if account amount ..","property":"payload.balance.amount","propertyType":"msg","rules":[{"t":"lte","v":"1000","vt":"num"},{"t":"gt","v":"1000","vt":"num"}],"checkall":"true","outputs":2,"x":1309.5411949157715,"y":993.6005001068115,"wires":[["2f9f013d.b96cce"],["b4397739.de4c98"]]},{"id":"2f9f013d.b96cce","type":"template","z":"8fb10fb2.5d2bf","name":"<= 1000","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<express-as type=\"Apology\">This is not good, I'm afraid you only have: {{payload.balance.amount}} euros left on your bank account! </express-as>","x":1533.895191192627,"y":947.766523361206,"wires":[["30351e05.6857f2"]]},{"id":"b4397739.de4c98","type":"template","z":"8fb10fb2.5d2bf","name":"> 1000","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<express-as type=\"GoodNews\">Well Done ! you got {{payload.balance.amount}} euros left on your bank account, you are rich!</express-as>","x":1413.395191192627,"y":1060.016523361206,"wires":[["30351e05.6857f2"]]},{"id":"4de6af9e.8021c","type":"function","z":"8fb10fb2.5d2bf","name":"set payload","func":"msg.payload = msg.speech;\nreturn msg;","outputs":1,"noerr":0,"x":1787.395191192627,"y":1241.016523361206,"wires":[[]]},{"id":"daf7a08a.beb93","type":"debug","z":"8fb10fb2.5d2bf","name":"","active":false,"console":"false","complete":"payload","x":1221.895191192627,"y":1192.516523361206,"wires":[]},{"id":"d2e5548f.23e708","type":"template","z":"8fb10fb2.5d2bf","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Hello! I'm Allison, but you can change my voice however you wish. <voice-transformation type=\"Custom\" glottal_tension=\"-80%\"> For example, you can make my voice a bit softer, </voice-transformation> <voice-transformation type=\"Custom\" glottal_tension=\"40%\" breathiness=\"40%\"> or a bit strained. </voice-transformation><voice-transformation type=\"Custom\" timbre=\"Breeze\" timbre_extent=\"60%\"> You can alter my voice timbre making me sound like this person, </voice-transformation> <voice-transformation type=\"Custom\" timbre=\"Sunrise\"> or like another person in your different applications. </voice-transformation><voice-transformation type=\"Custom\" breathiness=\"90%\"> You can make my voice more breathy than it is normally. </voice-transformation><voice-transformation type=\"Young\" strength=\"80%\"> I can speak like a young girl. </voice-transformation><voice-transformation type=\"Custom\" pitch=\"-30%\" pitch_range=\"80%\" rate=\"60%\" glottal_tension=\"-80%\" timbre=\"Sunrise\"> And you can combine all this with modifications of my speech rate and my tone. </voice-transformation>","x":1292.895191192627,"y":1320.766523361206,"wires":[["30351e05.6857f2"]]},{"id":"14258ec3.6b9d21","type":"inject","z":"8fb10fb2.5d2bf","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1190.8951797485352,"y":1246.2666034698486,"wires":[["d2e5548f.23e708"]]},{"id":"414f2800.c65e18","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/atms","tls":"","x":387.39519119262695,"y":915.016523361206,"wires":[["26f56e43.776882","488cf9a3.ce0fa8","85aecbae.54d488"]]},{"id":"3247c407.62ba3c","type":"debug","z":"8fb10fb2.5d2bf","name":"lat lon","active":false,"console":"false","complete":"payload","x":804.895191192627,"y":1179.516523361206,"wires":[]},{"id":"85aecbae.54d488","type":"function","z":"8fb10fb2.5d2bf","name":"get map on one atm","func":"msg.lat = msg.payload.atms[0].location.latitude;\nmsg.lon = msg.payload.atms[0].location.longitude;\nmsg.payload = {\"lat\": msg.lat, \"lon\": msg.lon};\nreturn msg;","outputs":1,"noerr":0,"x":604.895191192627,"y":1121.766523361206,"wires":[["3247c407.62ba3c","af05e072.d227b"]]},{"id":"a3c6e257.29aa8","type":"debug","z":"8fb10fb2.5d2bf","name":"","active":false,"console":"false","complete":"payload","x":731.395191192627,"y":1342.016523361206,"wires":[]},{"id":"af05e072.d227b","type":"template","z":"8fb10fb2.5d2bf","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <style>\n       #map {\n        height: 400px;\n        width: 100%;\n       }\n    </style>\n  </head>\n  <body>\n    <h3>My Google Maps Demo</h3>\n    <div id=\"map\"></div>\n    <script>\n\n    var lat = 34;\n\n    var lng = 45;\n      function initMap() {\n        var uluru = {lat:lat, lng: lng};\n        var map = new google.maps.Map(document.getElementById('map'), {\n          zoom: 4,\n          center: uluru\n        });\n        var marker = new google.maps.Marker({\n          position: uluru,\n          map: map\n        });\n      }\n    </script>\n    <script async defer\n    src=\"https://maps.googleapis.com/maps/api/js?key= AIzaSyDEu36gOfXSmEKkIAw3iDfFR5vnleZQ_f4 &callback=initMap\">\n    </script>\n  </body>\n</html>","x":543.395191192627,"y":1351.016523361206,"wires":[["a3c6e257.29aa8"]]},{"id":"26f56e43.776882","type":"xml","z":"8fb10fb2.5d2bf","name":"","x":595.395191192627,"y":988.016523361206,"wires":[[]]},{"id":"488cf9a3.ce0fa8","type":"debug","z":"8fb10fb2.5d2bf","name":"atms","active":false,"console":"false","complete":"payload","x":472.89519119262695,"y":1056.516523361206,"wires":[]},{"id":"470c7a7d.7719c4","type":"http response","z":"8fb10fb2.5d2bf","name":"","x":1361.581829071045,"y":1161.994306564331,"wires":[]},{"id":"8741970d.1ea398","type":"http in","z":"8fb10fb2.5d2bf","name":"","url":"/account","method":"get","swaggerDoc":"","x":245.0433235168457,"y":20,"wires":[["463190ee.597fe"]]},{"id":"1abb763c.2ddcfa","type":"template","z":"8fb10fb2.5d2bf","name":"","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\nMy amount is: {{payload.label}} eur !\n</html>","x":1191.895191192627,"y":1104.766523361206,"wires":[["470c7a7d.7719c4","daf7a08a.beb93"]]},{"id":"e84973fb.850f","type":"cloudant in","z":"8fb10fb2.5d2bf","name":"","cloudant":"","database":"","service":"bochackathon-cloudantNoSQLDB","search":"_id_","design":"","index":"","x":165.375,"y":487.66015625,"wires":[[]]},{"id":"4d4434a2.0b7f1c","type":"cloudant in","z":"8fb10fb2.5d2bf","name":"","database":"","service":"","search":"_id_","design":"","index":"","x":1231.6328620910645,"y":296.65625381469727,"wires":[[]]},{"id":"8d200d1e.60a5b","type":"function","z":"8fb10fb2.5d2bf","name":"prpforAPIcall SPECIFIC account and bank and view id","func":"\nmsg.accountid = msg.payload.accounts[1].id;\nmsg.viewid = msg.payload.accounts[1].views_available[0].id;\nmsg.bankid = msg.payload.accounts[1].bank_id;\n\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"26150fd04c3c482bb95af58fc47bf462\",\n    \"Auth-Provider-Name\":\"03310909626700\",\n    \"Auth-ID\":\"123456789\"\n    };\nreturn msg;","outputs":1,"noerr":0,"x":916.015625,"y":1281,"wires":[["b509376a.692448"]]},{"id":"b509376a.692448","type":"http request","z":"8fb10fb2.5d2bf","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts/{{accountid}}/{{viewid}}/account","tls":"","x":1134.0820693969727,"y":1459.4233951568604,"wires":[["ccd68a1b.193a38"]]},{"id":"ccd68a1b.193a38","type":"debug","z":"8fb10fb2.5d2bf","name":"ACCOUNT DETAILS","active":true,"console":"false","complete":"payload","x":1284.510612487793,"y":1558.9752826690674,"wires":[]},{"id":"5ea76c59.d976f4","type":"websocket out","z":"42cf2a1b.a5b9c4","name":"","server":"261a5627.9d158a","client":"","x":891.461441130634,"y":1196.8270351160775,"wires":[]},{"id":"9e0d0b18.4b1728","type":"websocket in","z":"42cf2a1b.a5b9c4","name":"","server":"261a5627.9d158a","client":"","x":619.9704818725586,"y":590.4511141777039,"wires":[["c8b85e1d.886e"]]},{"id":"b66a3163.35ad2","type":"template","z":"42cf2a1b.a5b9c4","name":"clems","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <title>ATM map BOC</title>\n    <style>\n      html, body, #map-canvas {\n        height: 100%;\n        margin: 0px;\n        padding: 0px\n      }\n    </style>\n    <script src=\"https://maps.googleapis.com/maps/api/js?v=3.exp\"></script>\n    <script>\n        \n        function degreesToRadians(degrees) {\n          return degrees * Math.PI / 180;\n        }\n        \n        function distanceInKmBetweenEarthCoordinates(lat1, lon1, lat2, lon2) {\n          var earthRadiusKm = 6371;\n        \n          var dLat = degreesToRadians(lat2-lat1);\n          var dLon = degreesToRadians(lon2-lon1);\n        \n          lat1 = degreesToRadians(lat1);\n          lat2 = degreesToRadians(lat2);\n        \n          var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n                  Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); \n          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n          return earthRadiusKm * c;\n        }\n\t\tfunction initialize() {\n\n\t\t  var myLatlng = new google.maps.LatLng(35.1856,33.3823);\n\t\t  var mapOptions = {\n\t\t    zoom: 15,\n\t\t    center: myLatlng\n\t\t  };\n\t\t  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);\n\t\t  var  infoWindow = new google.maps.InfoWindow;\n          var dist=100;\n\t\t  var positionL;\n\t\t  var curLat;\n          var curLng;\n\t\t  if (navigator.geolocation) {\n              navigator.geolocation.getCurrentPosition(function(position) {\n                pos = {\n                  lat: position.coords.latitude,\n                  lng: position.coords.longitude\n                };\n                positionL = pos;\n                infoWindow.setPosition(pos);\n                infoWindow.setContent('My Location !');\n                infoWindow.open(map);\n                map.setCenter(pos);\n              }, function() {\n                handleLocationError(true, infoWindow, map.getCenter());\n              });\n\t\t  }\n\n\t\t  \n\t\t  /*if (navigator.geolocation) {\n              console.log('Geolocation is supported!');\n              var startPos;\n              var geoSuccess = function(position) {\n                startPos = position;\n                console.log(startPos);\n                \n                var image = 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png';\n                var markerLoc = new google.maps.Marker({\n        \t\t\tposition: new google.maps.LatLng(startPos.coords.latitude,startPos.coords.longitude),\n        \t\t\tmap: map,\n        \t\t\ticon: image,\n        \t\t\tanimation: google.maps.Animation.DROP,\n        \t\t\ttitle: \"My location\"\n        \t    });\n              };\n              navigator.geolocation.getCurrentPosition(geoSuccess);\n              \n            }\n            else {\n                console.log('Geolocation is not supported for this Browser/OS.');\n            }*/\n\n\t\t  var loc = window.location;\n          if (loc.protocol === \"https:\") {\n            newUri = \"wss:\";\n          } else {\n            newUri = \"ws:\";\n          }\n          newUri += \"//\" + loc.host + \"/ws/locs\";\n\t\t  // check for Geolocation support\n\t\t \n\n          \n\n\t\t  \n\t\t  var sock = new WebSocket(newUri);\n\t\t  sock.onopen = function(){ \n\t\t    console.log(\"Connected websocket\");\n\t\t    console.log(\"Sending ping..\");\n\t\t\tsock.send(\"Ping!\");\n\t\t    console.log(\"Ping sent..\");\n\t\t  };\n\t\t  sock.onerror = function(){ console.log(\"Websocket error\"); };\n\t\t  sock.onmessage = function(evt){\n\t\t    var stationData = JSON.parse(evt.data);\n\t\t    console.log(stationData.atms);\n\t\t    //var stations = stationData.root.stations[0].station;\n\t\t\tfor(var i = 0; i < stationData.atms.length; i++) {\n\t\t\t \n\t\t\t  var station = stationData.atms[i];\n\t\t\n              var marker = new google.maps.Marker({\n\t\t\t    position: new google.maps.LatLng(station.location.latitude,station.location.longitude),\n\t\t\t    map: map,\n\t\t\t    animation: google.maps.Animation.DROP,\n\t\t\t    title: station.name\n\t\t\t  });\n\t\t\t  console.log(positionL);\n\t\t\t  console.log(\"currentDist : \" +distanceInKmBetweenEarthCoordinates(positionL.lat, positionL.lng, station.location.latitude,station.location.longitude));\n\t\t\t  //console.log(pos.lat +\",\"+ pos.lng +\",\"+ station.location.latitude +\",\"+ station.location.longitude);\n              var dist2 = distanceInKmBetweenEarthCoordinates(positionL.lat, positionL.lng, station.location.latitude,station.location.longitude);\n              \n              if(dist > dist2){\n                  dist = dist2;\n                  curLat= station.location.latitude;\n                  curLng = station.location.longitude;\n              }\n\t\t\t  \n\t\t\t}\n\t\t\tconsole.log(\"distance: \" +dist);\n\t\t\tconsole.log(\"coor: \" +curLat +\",\"+curLng);\n\t\t\tvar coor = {\n                  lat: curLat,\n                  lng: curLng\n                };\n\t\t\tvar  infoWindowClose = new google.maps.InfoWindow;\n            infoWindowClose.setPosition(coor);\n            infoWindowClose.setContent('Closest ATM !');\n            infoWindowClose.open(map);\n            map.setCenter(coor);\n\t\t\t\n\t\t  };\n\t\t  \n\t\t};\n\t\t\n\t\tgoogle.maps.event.addDomListener(window, 'load', initialize);\n        \n    </script>\n  </head>\n  <body>\n    <div id=\"map-canvas\"></div>\n  </body>\n</html>","x":589.8555526733398,"y":1759.830249786377,"wires":[["857e3328.9eea6"]]},{"id":"4eed262e.c35178","type":"inject","z":"d7e53ff3.39e67","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":215.765625,"y":440.54148507118225,"wires":[["baae722f.e1f32"]]},{"id":"baae722f.e1f32","type":"function","z":"d7e53ff3.39e67","name":"prepforAPIcall getBanks","func":"\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\" 70ce2fe532664019b4ba950f48e1fd3e\"\n    };\n\n\n// msg.payload  = {\"tablename\":\"Input data\", \n// \"header\":[\"customerID\",\"gender\",\"SeniorCitizen\",\"Partner\",\"Dependents\",\"tenure\",\"PhoneService\",\"MultipleLines\",\"InternetService\",\"OnlineSecurity\",\"OnlineBackup\",\"DeviceProtection\",\"TechSupport\",\"StreamingTV\",\"StreamingMovies\",\"Contract\",\"PaperlessBilling\",\"PaymentMethod\",\"MonthlyCharges\",\"TotalCharges\",\"Churn\",\"SampleWeight\"], \n// \"data\":[[\"5919-TMRGD\",\"Female\",\"0\",\"No\",\"Yes\",\"1\",\"Yes\",\"No\",\"Fiber optic\",\"No\",\"No\",\"No\",\"No\",\"Yes\",\"No\",\"Month-to-month\",\"Yes\",\"Electronic check\",79.350,79.350,\"Yes\",1.000]]\n// };\n \n\n\nreturn msg;","outputs":1,"noerr":0,"x":574.9271469116211,"y":244.89949417114258,"wires":[["7f4f1e7e.3f233"]]},{"id":"757dbba3.623934","type":"debug","z":"d7e53ff3.39e67","name":"bankid","active":true,"console":"false","complete":"payload.banks[0].id","x":997.2841682434082,"y":308.37763690948486,"wires":[]},{"id":"7f4f1e7e.3f233","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks[?subscription-key]","tls":"","x":814.0618782043457,"y":311.349835395813,"wires":[["757dbba3.623934","1617f1d4.50f7ce"]]},{"id":"e950f434.10d808","type":"function","z":"d7e53ff3.39e67","name":"prepforAPIcall SPECIFIC bank id","func":"\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"70ce2fe532664019b4ba950f48e1fd3e\",\n    \"Auth-Provider-Name\":\"devuser\",\n    \"Auth-ID\":\"123456789\"\n    };\n\nmsg.bankid  = msg.payload.banks[0].id; \n// msg.payload  = {\"tablename\":\"Input data\", \n// \"header\":[\"customerID\",\"gender\",\"SeniorCitizen\",\"Partner\",\"Dependents\",\"tenure\",\"PhoneService\",\"MultipleLines\",\"InternetService\",\"OnlineSecurity\",\"OnlineBackup\",\"DeviceProtection\",\"TechSupport\",\"StreamingTV\",\"StreamingMovies\",\"Contract\",\"PaperlessBilling\",\"PaymentMethod\",\"MonthlyCharges\",\"TotalCharges\",\"Churn\",\"SampleWeight\"], \n// \"data\":[[\"5919-TMRGD\",\"Female\",\"0\",\"No\",\"Yes\",\"1\",\"Yes\",\"No\",\"Fiber optic\",\"No\",\"No\",\"No\",\"No\",\"Yes\",\"No\",\"Month-to-month\",\"Yes\",\"Electronic check\",79.350,79.350,\"Yes\",1.000]]\n// };\n \n\n\nreturn msg;","outputs":1,"noerr":0,"x":402.50627517700195,"y":847.2942323684692,"wires":[["ec070462.ef1748","6a8f683.d8fd798","becfb799.d4e758","ece6f1ed.940f1","1a34719c.ee6d6e","5f1e083f.2f38b8","faf7c7db.4fe978"]]},{"id":"f4941318.42949","type":"debug","z":"d7e53ff3.39e67","name":"debug02","active":false,"console":"false","complete":"true","x":997.2841682434082,"y":399.48872089385986,"wires":[]},{"id":"1617f1d4.50f7ce","type":"switch","z":"d7e53ff3.39e67","name":"if BANK ID returned","property":"payload.banks[0].id","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","outputs":2,"x":538.506275177002,"y":427.9053773880005,"wires":[["f4941318.42949"],["e950f434.10d808","90926672.669a08"]]},{"id":"b76a2c34.31e8a","type":"debug","z":"d7e53ff3.39e67","name":"bank details","active":false,"console":"false","complete":"true","x":1023.1808433532715,"y":455.7332887649536,"wires":[]},{"id":"ec070462.ef1748","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/customer","tls":"","x":812.895191192627,"y":666.7665224075317,"wires":[["49482428.3ca68c"]]},{"id":"49482428.3ca68c","type":"debug","z":"d7e53ff3.39e67","name":"customerID","active":false,"console":"false","complete":"payload","x":1021.8952255249023,"y":677.5165500640869,"wires":[]},{"id":"90926672.669a08","type":"debug","z":"d7e53ff3.39e67","name":"bankid","active":false,"console":"false","complete":"true","x":835.395191192627,"y":434.01652240753174,"wires":[]},{"id":"6a8f683.d8fd798","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks","tls":"","x":825.284107208252,"y":534.2386903762817,"wires":[["b76a2c34.31e8a"]]},{"id":"becfb799.d4e758","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/customers/7a542b37a86d189b5dd0b947","tls":"","x":793.395191192627,"y":745.0165224075317,"wires":[["9e5e553b.966588"]]},{"id":"9e5e553b.966588","type":"debug","z":"d7e53ff3.39e67","name":"customer details","active":false,"console":"false","complete":"payload","x":1015.895191192627,"y":743.5165224075317,"wires":[]},{"id":"ece6f1ed.940f1","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts","tls":"","x":837.395191192627,"y":598.0165224075317,"wires":[["10e2238f.bd4a5c"]]},{"id":"1a34719c.ee6d6e","type":"debug","z":"d7e53ff3.39e67","name":"","active":false,"console":"false","complete":"payload","x":760.895191192627,"y":492.51652240753174,"wires":[]},{"id":"b6ff1cd2.05439","type":"function","z":"d7e53ff3.39e67","name":"get Accounts","func":"msg.payload = msg.payload.accounts;\nreturn msg;","outputs":1,"noerr":0,"x":1121.895149230957,"y":557.7666263580322,"wires":[["500f0060.fcd18"]]},{"id":"10e2238f.bd4a5c","type":"json","z":"d7e53ff3.39e67","name":"","x":973.895191192627,"y":557.7665224075317,"wires":[["b6ff1cd2.05439"]]},{"id":"5f1e083f.2f38b8","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts","tls":"","x":775.395191192627,"y":850.0165224075317,"wires":[["fbed9326.a161b"]]},{"id":"fbed9326.a161b","type":"json","z":"d7e53ff3.39e67","name":"","x":887.895191192627,"y":907.7665224075317,"wires":[["b98d69b9.3a43b8"]]},{"id":"b98d69b9.3a43b8","type":"function","z":"d7e53ff3.39e67","name":"prpforAPIcall SPECIFIC account and bank and view id","func":"msg.balancess = msg.payload.accounts[0].balance_amount;\nmsg.accountid = msg.payload.accounts[0].id;\nmsg.viewid = msg.payload.accounts[0].views_available[0].id;\nmsg.bankid = msg.payload.accounts[0].bank_id;\n\nmsg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"70ce2fe532664019b4ba950f48e1fd3e\",\n    \"Auth-Provider-Name\":\"03310909626700\",\n    \"Auth-ID\":\"123456789\"\n    };\nreturn msg;","outputs":1,"noerr":0,"x":828.895191192627,"y":1007.7665224075317,"wires":[["2efb60d7.6ff7b","a6465617.642d78","d12e0e11.9cdfb","dafab6dc.8b27d8"]]},{"id":"2efb60d7.6ff7b","type":"debug","z":"d7e53ff3.39e67","name":"ONE ACCount ID","active":false,"console":"false","complete":"accountid","x":1141.895191192627,"y":839.5165224075317,"wires":[]},{"id":"d12e0e11.9cdfb","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts/{{accountid}}/{{viewid}}/account","tls":"","x":1061.4060821533203,"y":1189.634391784668,"wires":[["d1c3bb38.c79c28","57b625fd.6e403c","68fcae55.fa3f6","b13a76da.1b81b8"]]},{"id":"a6465617.642d78","type":"debug","z":"d7e53ff3.39e67","name":"ONE View ID","active":false,"console":"false","complete":"viewid","x":1163.395191192627,"y":937.0165224075317,"wires":[]},{"id":"64618a84.7d2494","type":"watson-text-to-speech","z":"d7e53ff3.39e67","name":"","lang":"en-US","langhidden":"en-US","langcustom":"NoCustomisationSetting","langcustomhidden":"","voice":"en-US_AllisonVoice","voicehidden":"en-US_AllisonVoice","format":"audio/wav","password":"","payload-response":false,"default-endpoint":true,"service-endpoint":"https://stream.watsonplatform.net/text-to-speech/api","x":1612.1431846618652,"y":1580.8485746383667,"wires":[["53e4bef3.9a01f"]]},{"id":"d1c3bb38.c79c28","type":"switch","z":"d7e53ff3.39e67","name":"if account amount ..","property":"payload.balance.amount","propertyType":"msg","rules":[{"t":"lte","v":"1000","vt":"num"},{"t":"gt","v":"1000","vt":"num"}],"checkall":"true","outputs":2,"x":1344.5411949157715,"y":1086.6004991531372,"wires":[["b8fed760.970d48"],["ac000766.98caa8"]]},{"id":"b8fed760.970d48","type":"template","z":"d7e53ff3.39e67","name":"<= 1000","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<express-as type=\"Apology\">This is not good, I'm afraid you only have: {{payload.balance.amount}} euros left on your bank account! </express-as>","x":1572.8951416015625,"y":1038.7665824890137,"wires":[["64618a84.7d2494"]]},{"id":"ac000766.98caa8","type":"template","z":"d7e53ff3.39e67","name":"> 1000","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<express-as type=\"GoodNews\">Well Done ! you got {{payload.balance.amount}} euros left on your bank account, you are rich!</express-as>","x":1448.395191192627,"y":1151.0165224075317,"wires":[["64618a84.7d2494"]]},{"id":"53e4bef3.9a01f","type":"function","z":"d7e53ff3.39e67","name":"set payload","func":"msg.payload = msg.speech;\nreturn msg;","outputs":1,"noerr":0,"x":1832.3951416015625,"y":1344.0164794921875,"wires":[[]]},{"id":"b598fbe3.62c998","type":"debug","z":"d7e53ff3.39e67","name":"","active":false,"console":"false","complete":"payload","x":1234.8168869018555,"y":1283.5164413452148,"wires":[]},{"id":"f57ea98.33bb358","type":"template","z":"d7e53ff3.39e67","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Hello! I'm Allison, but you can change my voice however you wish. <voice-transformation type=\"Custom\" glottal_tension=\"-80%\"> For example, you can make my voice a bit softer, </voice-transformation> <voice-transformation type=\"Custom\" glottal_tension=\"40%\" breathiness=\"40%\"> or a bit strained. </voice-transformation><voice-transformation type=\"Custom\" timbre=\"Breeze\" timbre_extent=\"60%\"> You can alter my voice timbre making me sound like this person, </voice-transformation> <voice-transformation type=\"Custom\" timbre=\"Sunrise\"> or like another person in your different applications. </voice-transformation><voice-transformation type=\"Custom\" breathiness=\"90%\"> You can make my voice more breathy than it is normally. </voice-transformation><voice-transformation type=\"Young\" strength=\"80%\"> I can speak like a young girl. </voice-transformation><voice-transformation type=\"Custom\" pitch=\"-30%\" pitch_range=\"80%\" rate=\"60%\" glottal_tension=\"-80%\" timbre=\"Sunrise\"> And you can combine all this with modifications of my speech rate and my tone. </voice-transformation>","x":1327.895191192627,"y":1411.7665224075317,"wires":[["64618a84.7d2494"]]},{"id":"56cea1fa.3bddc","type":"inject","z":"d7e53ff3.39e67","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":1225.8951797485352,"y":1337.2666025161743,"wires":[["f57ea98.33bb358"]]},{"id":"faf7c7db.4fe978","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"obj","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/atms","tls":"","x":403.50634002685547,"y":980.4609861373901,"wires":[["3ded0f90.aebcd","4b02883f.0c0698","67d68076.a720f"]]},{"id":"215110fa.e0258","type":"debug","z":"d7e53ff3.39e67","name":"lat lon","active":false,"console":"false","complete":"payload","x":839.895191192627,"y":1270.5165224075317,"wires":[]},{"id":"67d68076.a720f","type":"function","z":"d7e53ff3.39e67","name":"get map on one atm","func":"msg.lat = msg.payload.atms[0].location.latitude;\nmsg.lon = msg.payload.atms[0].location.longitude;\nmsg.payload = {\"lat\": msg.lat, \"lon\": msg.lon};\nreturn msg;","outputs":1,"noerr":0,"x":639.895191192627,"y":1212.7665224075317,"wires":[["215110fa.e0258","676b42d9.42753c","ad17165d.209d38"]]},{"id":"66012fbc.cece8","type":"debug","z":"d7e53ff3.39e67","name":"","active":false,"console":"false","complete":"payload","x":766.395191192627,"y":1433.0165224075317,"wires":[]},{"id":"676b42d9.42753c","type":"template","z":"d7e53ff3.39e67","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <style>\n       #map {\n        height: 400px;\n        width: 100%;\n       }\n    </style>\n  </head>\n  <body>\n    <h3>My Google Maps Demo</h3>\n    <div id=\"map\"></div>\n    <script>\n\n    var lat = 34;\n\n    var lng = 45;\n      function initMap() {\n        var uluru = {lat:lat, lng: lng};\n        var map = new google.maps.Map(document.getElementById('map'), {\n          zoom: 4,\n          center: uluru\n        });\n        var marker = new google.maps.Marker({\n          position: uluru,\n          map: map\n        });\n      }\n    </script>\n    <script async defer\n    src=\"https://maps.googleapis.com/maps/api/js?key= AIzaSyDEu36gOfXSmEKkIAw3iDfFR5vnleZQ_f4 &callback=initMap\">\n    </script>\n  </body>\n</html>","x":578.395191192627,"y":1442.0165224075317,"wires":[["66012fbc.cece8"]]},{"id":"ad17165d.209d38","type":"websocket out","z":"d7e53ff3.39e67","name":"","server":"a5e060c3.a9f78","client":"","x":850.395191192627,"y":1163.0165224075317,"wires":[]},{"id":"f5888f68.a21a6","type":"http in","z":"d7e53ff3.39e67","name":"","url":"/map","method":"get","swaggerDoc":"","x":527.3952026367188,"y":1630.0164794921875,"wires":[["2643ea28.37a966"]]},{"id":"258d6458.9b117c","type":"http response","z":"d7e53ff3.39e67","name":"","x":913.395191192627,"y":1630.0165224075317,"wires":[]},{"id":"2643ea28.37a966","type":"template","z":"d7e53ff3.39e67","name":"","field":"payload","fieldType":"msg","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <title>Bart Stations</title>\n    <style>\n      html, body, #map-canvas {\n        height: 100%;\n        margin: 0px;\n        padding: 0px\n      }\n    </style>\n    <script src=\"https://maps.googleapis.com/maps/api/js?v=3.exp\"></script>\n    <script>\n\t\tfunction initialize() {\n\t\t  var myLatlng = new google.maps.LatLng(37.765062,-122.419694);\n\t\t  var mapOptions = {\n\t\t    zoom: 10,\n\t\t    center: myLatlng\n\t\t  };\n\t\t  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);\n\t\t  \n\t\t  var loc = window.location;\n          if (loc.protocol === \"https:\") {\n            newUri = \"wss:\";\n          } else {\n            newUri = \"ws:\";\n          }\n          newUri += \"//\" + loc.host + \"/ws/stations\";\n\t\t  \n\t\t  \n\t\t  var sock = new WebSocket(newUri);\n\t\t  sock.onopen = function(){ \n\t\t    console.log(\"Connected websocket\");\n\t\t    console.log(\"Sending ping..\");\n\t\t\tsock.send(\"Ping!\");\n\t\t    console.log(\"Ping sent..\");\n\t\t  };\n\t\t  sock.onerror = function(){ console.log(\"Websocket error\"); };\n\t\t  sock.onmessage = function(evt){\n\t\t    var stationData = JSON.parse(evt.data);\n\t\t    //var stations = stationData.root.stations[0].station;\n\t\t\tfor(var i = 0; i < stations.length; i++) {\n\t\t\t  var station = stationData[i];\n\t\t\t  console.log(stationData[i].name);\n              var marker = new google.maps.Marker({\n\t\t\t    position: new google.maps.LatLng(station.location.latitude,station.location.longitude),\n\t\t\t    map: map,\n\t\t\t    animation: google.maps.Animation.DROP,\n\t\t\t    title: station.name\n\t\t\t  });\n\t\t\t  \n\t\t\t}\n\t\t  };\n\t\t};\n\t\t\n\t\tgoogle.maps.event.addDomListener(window, 'load', initialize);\n\n    </script>\n  </head>\n  <body>\n    <div id=\"map-canvas\"></div>\n  </body>\n</html>","x":749.9508056640625,"y":1630.349853515625,"wires":[["258d6458.9b117c"]]},{"id":"3ded0f90.aebcd","type":"xml","z":"d7e53ff3.39e67","name":"","x":630.395191192627,"y":1079.0165224075317,"wires":[["9a6df4fa.572f28"]]},{"id":"9a6df4fa.572f28","type":"websocket out","z":"d7e53ff3.39e67","name":"","server":"261a5627.9d158a","client":"","x":815.395191192627,"y":1079.0165224075317,"wires":[]},{"id":"ea994712.486a48","type":"websocket in","z":"d7e53ff3.39e67","name":"","server":"261a5627.9d158a","x":125.39519119262695,"y":987.0165224075317,"wires":[["e950f434.10d808"]]},{"id":"4b02883f.0c0698","type":"debug","z":"d7e53ff3.39e67","name":"atms","active":false,"console":"false","complete":"payload","x":507.89519119262695,"y":1147.5165224075317,"wires":[]},{"id":"2f0b3a6c.cc3ef6","type":"http response","z":"d7e53ff3.39e67","name":"","x":1396.581829071045,"y":1252.9943056106567,"wires":[]},{"id":"83f8e5c4.d50758","type":"http in","z":"d7e53ff3.39e67","name":"","url":"/balance","method":"get","swaggerDoc":"","x":280.0433235168457,"y":110.99999904632568,"wires":[["baae722f.e1f32"]]},{"id":"57b625fd.6e403c","type":"template","z":"d7e53ff3.39e67","name":"","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"My amount is: {{{payload.balance.amount}}} eur !\n","x":1226.895191192627,"y":1195.7665224075317,"wires":[["2f0b3a6c.cc3ef6","b598fbe3.62c998"]]},{"id":"4aef08f0.10d388","type":"http in","z":"d7e53ff3.39e67","name":"","url":"/mybalance","method":"get","swaggerDoc":"","x":498.3750305175781,"y":1706.63671875,"wires":[["778ae4f5.b2b58c"]]},{"id":"59e22b26.0d2c44","type":"template","z":"d7e53ff3.39e67","name":"","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<html>\n    \nMy balance is: <script>var m=msg.payload.accounts[0].balance_amount; msg.res(m)</script> eur !\n<style>{{{payload.style}}}</style>\n</html>","x":786.8263511657715,"y":1769.5365891456604,"wires":[["62644b5d.470454"]]},{"id":"62644b5d.470454","type":"http response","z":"d7e53ff3.39e67","name":"","x":918.1328125,"y":1706.49609375,"wires":[]},{"id":"68fcae55.fa3f6","type":"debug","z":"d7e53ff3.39e67","name":"ACCOUNT INFO","active":true,"console":"false","complete":"payload","x":1351.87890625,"y":990.78515625,"wires":[]},{"id":"560f9fc6.5fdd4","type":"change","z":"540c37ca.a66028","name":"Extract image URL","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.imageurl","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":455.89581298828125,"y":244.99996948242188,"wires":[["5af93137.4def6"]]},{"id":"5b4716e6.96eaa8","type":"switch","z":"540c37ca.a66028","name":"Check image url","property":"payload.imageurl","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"true","outputs":2,"x":485.89581298828125,"y":84.99996948242188,"wires":[["44361158.17492"],["560f9fc6.5fdd4"]]},{"id":"efbb1fa0.42a73","type":"http in","z":"540c37ca.a66028","name":"","url":"/people","method":"get","swaggerDoc":"","x":290.89581298828125,"y":84.99997138977051,"wires":[["5b4716e6.96eaa8"]]},{"id":"44361158.17492","type":"template","z":"540c37ca.a66028","name":"Prompt images","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h1>Bank of Cyprus' Visual Recognition </h1>\n<form  action=\"{{req._parsedUrl.pathname}}\">\n    <img src=\"http://www.imhbusiness.com/images/Conferences/conferences2014/PROFESSIONAL/BANK%20OF%20CYPRUS.jpg\" height='200'/>\n       <br/>Upload a photo of a person and find out the best bank products applied on them</br>\n    <br>Image URL: <input type=\"text\" name=\"imageurl\"/>\n    <input type=\"submit\" value=\"Analyze\"/>\n</form>","x":777.4515991210938,"y":89.77776336669922,"wires":[["867b8c4c.3ab84"]]},{"id":"92840865.9a3758","type":"template","z":"540c37ca.a66028","name":"Report faces via HTML template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h1>Visual Recognition v3 Image Analysis</h1>\n    <p>Analyzed image: ... <br/><img id=\"image\" src=http://www.imhbusiness.com/images/Conferences/conferences2014/PROFESSIONAL/BANK%20OF%20CYPRUS.jpg\" height=\"200\"/></p>\n    {{^result}}\n        <P>No Face detected</P>\n    {{/result}}\n    <p>Images Processed: {{result.images_processed}}</p>\n        <table border='1'>\n        <p>Age Range:   {{msg.result.images[0].faces[0].age.min}}-{{msg.result.images[0].faces[0].age.max}}</p>\n        <p>Gender:   {{msg.result.images[0].faces[0].gender.gender}} </p>;\n        <script>\n             \n         </script>\n             <td>{{gender.gender}}</td><td>{{gender.score}}</td>\n             <td>{{identity.name}} ({{identity.score}})</td>\n         </tr>{{/result.images.0.faces}}\n    <form  action=\"{{req._parsedUrl.pathname}}\">\n        <br><input type=\"submit\" value=\"Try again or go back to the home page\"/>\n    </form>","x":788.8958358764648,"y":183.9999771118164,"wires":[["867b8c4c.3ab84"]]},{"id":"867b8c4c.3ab84","type":"http response","z":"540c37ca.a66028","name":"","x":1095.8958129882812,"y":84.99996948242188,"wires":[]},{"id":"5af93137.4def6","type":"visual-recognition-v3","z":"540c37ca.a66028","name":"","apikey":"","image-feature":"detectFaces","x":463.89581298828125,"y":386.9999694824219,"wires":[["92840865.9a3758","49b634e6.1cef0c","b5907b7e.6f3428","7a3bef8e.d2b25"]]},{"id":"49b634e6.1cef0c","type":"debug","z":"540c37ca.a66028","name":"Print msg.result.images","active":true,"console":"false","complete":"result.images","x":775.8958129882812,"y":484.9999694824219,"wires":[]},{"id":"b5907b7e.6f3428","type":"template","z":"540c37ca.a66028","name":"Print result via a template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"// Template functions can access the json array via this .0. notation.\n// See the Watson Visual Recognition v3 API Documentation at\n// https://watson-api-explorer.mybluemix.net/apis/visual-recognition-v3#!/visual-recognition/get_v3_detect_faces\n\nFirst face in result is a {{result.images.faces.0.gender.gender}} !","x":775.8958129882812,"y":284.9999694824219,"wires":[["e7a976fd.a2f6c8"]]},{"id":"e7a976fd.a2f6c8","type":"debug","z":"540c37ca.a66028","name":"","active":true,"console":"false","complete":"payload","x":1115.8958129882812,"y":284.9999694824219,"wires":[]},{"id":"7a3bef8e.d2b25","type":"function","z":"540c37ca.a66028","name":"Is this a Celebrity","func":"// A function to determine if this image contains a celebrity.\n// Functions can access the msg.result via array indexes\n// Watson Visual Recognition v3 API Documentation is post here:\n// https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?node#detect_faces\nvar i=0;\nvar Celebrity=0;\nvar CelebrityName=\"No one famous detected\";\n\n// There might be multiple faces in this image.\n// Loop through the faces and determine if Watson has\n// detected the identity of at least one celebrity.\nwhile ( msg.result.images[0].faces[i] ) {\n    if (msg.result.images[0].faces[i].identity != null) {\n        Celebrity=1;\n        CelebrityName=msg.result.images[0].faces[i].identity.name;\n    }\n    i++;\n}\n\nmsg.payload = CelebrityName;\n// if a Celebrity was found, send the Name to output 1\n// else send the default \"No one famous detected\" to output 2\nif (Celebrity == 1) {\n        return [ msg, null ];\n} else {\n    return [ null, msg ];\n}\n","outputs":"2","noerr":0,"x":755.8958129882812,"y":384.9999694824219,"wires":[["168f965e.acd4ca"],["43383ea0.8ec7b"]]},{"id":"43383ea0.8ec7b","type":"debug","z":"540c37ca.a66028","name":"","active":true,"console":"false","complete":"payload","x":1115.8958129882812,"y":404.9999694824219,"wires":[]},{"id":"168f965e.acd4ca","type":"template","z":"540c37ca.a66028","name":"Paparazzi","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This image contains a celebrity: {{payload}} !","x":955.8958568572998,"y":343.9999885559082,"wires":[["43383ea0.8ec7b"]]},{"id":"710db23f.f60b2c","type":"comment","z":"540c37ca.a66028","name":"Step #1 - Create a Visual Recognition Service","info":"1. Log into your Bluemix account\n2. Navigate to the Bluemix Catalog\n3. Scroll to the Watson Services section\n4. Find and click on the Visual Recognition service\n5. Create an unbounded Visual Recognition instance\n6. Open the new service and navigate to the Service Credentials\n7. Copy the api_key to the clipboard\n8. Open the above \"visual recognition v3\" node and paste your new API Key","x":415.89581298828125,"y":444.9999694824219,"wires":[]},{"id":"585db6d8.010c98","type":"change","z":"358f4f87.0edb8","name":"Extract image URL","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.imageurl","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":446,"y":308,"wires":[["fc258f7a.fd54a"]]},{"id":"12c89e21.de5072","type":"switch","z":"358f4f87.0edb8","name":"Check image url","property":"payload.imageurl","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"true","outputs":2,"x":476,"y":148,"wires":[["36f2f86a.b0d468"],["585db6d8.010c98"]]},{"id":"7cbdfe93.7d1","type":"http in","z":"358f4f87.0edb8","name":"","url":"/peoplet","method":"get","swaggerDoc":"","x":286,"y":148,"wires":[["12c89e21.de5072"]]},{"id":"36f2f86a.b0d468","type":"template","z":"358f4f87.0edb8","name":"Prompt images","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h1>Welcome to a Watson Visual Recognition sample Face Detection app</h1>\n<H2>Recognize anyone?</H2>\n<form  action=\"{{req._parsedUrl.pathname}}\">\n    <img src=\"http://sysrun.haifa.il.ibm.com/ibm/history/exhibits/chairmen/images/watsonsr.jpg\" height='200'/>\n    <img src=\"http://www.awaken.com/wp-content/uploads/2015/05/forbes.jpg\" height='200'/>\n    <img src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/LinuxCon_Europe_Linus_Torvalds_03.jpg/220px-LinuxCon_Europe_Linus_Torvalds_03.jpg\" height='200'/>\n    <img src=\"http://smashinghub.com/wp-content/uploads/2012/01/nb5.jpg\" height='200'/>\n        <br/>Right-click one of the above images and select Copy image location and paste the URL in the box below.<br>Do an image search for faces, try multiple faces. After you click on an image, to the right it usually says \"View image\" click that to get the URL.<br/>\n    <br>Image URL: <input type=\"text\" name=\"imageurl\"/>\n    <input type=\"submit\" value=\"Analyze\"/>\n</form>","x":736,"y":148,"wires":[["5f8a5f9f.1e436"]]},{"id":"a52329e7.9b7478","type":"template","z":"358f4f87.0edb8","name":"Report faces via HTML template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<h1>Visual Recognition v3 Image Analysis</h1>\n    <p>Analyzed image: {{result.images.0.resolved_url}}<br/><img id=\"image\" src=\"{{result.images.0.resolved_url}}\" height=\"200\"/></p>\n    {{^result}}\n        <P>No Face detected</P>\n    {{/result}}\n    <p>Images Processed: {{result.images_processed}}</p>\n    <table border='1'>\n        <thead><tr><th>Age Range</th><th>Confidence</th><th>Gender</th><th>Confidence</th><th>Name</th></tr></thead>\n        {{#result.images.0.faces}}<tr>\n            <td><b>{{age.min}} - {{age.max}}</b></td><td><i>{{age.score}}</i></td>\n            <td>{{gender.gender}}</td><td>{{gender.score}}</td>\n            <td>{{identity.name}} ({{identity.score}})</td>\n        </tr>{{/result.images.0.faces}}\n    </table>\n    <form  action=\"{{req._parsedUrl.pathname}}\">\n        <br><input type=\"submit\" value=\"Try again or go back to the home page\"/>\n    </form>","x":786,"y":248,"wires":[["5f8a5f9f.1e436"]]},{"id":"5f8a5f9f.1e436","type":"http response","z":"358f4f87.0edb8","name":"","x":1086,"y":148,"wires":[]},{"id":"fc258f7a.fd54a","type":"visual-recognition-v3","z":"358f4f87.0edb8","name":"","apikey":"","image-feature":"detectFaces","x":456,"y":448,"wires":[["a52329e7.9b7478","e0272390.e7769","34d2d86b.7877f8","15a9ce26.6387b2"]]},{"id":"e0272390.e7769","type":"debug","z":"358f4f87.0edb8","name":"Print msg.result.images","active":true,"console":"false","complete":"result.images","x":766,"y":548,"wires":[]},{"id":"34d2d86b.7877f8","type":"template","z":"358f4f87.0edb8","name":"Print result via a template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"// Template functions can access the json array via this .0. notation.\n// See the Watson Visual Recognition v3 API Documentation at\n// https://watson-api-explorer.mybluemix.net/apis/visual-recognition-v3#!/visual-recognition/get_v3_detect_faces\n\nFirst face in result is a {{result.images.0.faces.0.gender.gender}} !","x":766,"y":348,"wires":[["1dbb9896.0c7017"]]},{"id":"1dbb9896.0c7017","type":"debug","z":"358f4f87.0edb8","name":"","active":true,"console":"false","complete":"payload","x":1106,"y":348,"wires":[]},{"id":"15a9ce26.6387b2","type":"function","z":"358f4f87.0edb8","name":"Is this a Celebrity","func":"// A function to determine if this image contains a celebrity.\n// Functions can access the msg.result via array indexes\n// Watson Visual Recognition v3 API Documentation is post here:\n// https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?node#detect_faces\nvar i=0;\nvar Celebrity=0;\nvar CelebrityName=\"No one famous detected\";\n\n// There might be multiple faces in this image.\n// Loop through the faces and determine if Watson has\n// detected the identity of at least one celebrity.\nwhile ( msg.result.images[0].faces[i] ) {\n    if (msg.result.images[0].faces[i].identity != null) {\n        Celebrity=1;\n        CelebrityName=msg.result.images[0].faces[i].identity.name;\n    }\n    i++;\n}\n\nmsg.payload = CelebrityName;\n// if a Celebrity was found, send the Name to output 1\n// else send the default \"No one famous detected\" to output 2\nif (Celebrity == 1) {\n        return [ msg, null ];\n} else {\n    return [ null, msg ];\n}\n","outputs":"2","noerr":0,"x":746,"y":448,"wires":[["7a7a738a.dc2fbc"],["845630e4.42401"]]},{"id":"845630e4.42401","type":"debug","z":"358f4f87.0edb8","name":"","active":true,"console":"false","complete":"payload","x":1106,"y":468,"wires":[]},{"id":"7a7a738a.dc2fbc","type":"template","z":"358f4f87.0edb8","name":"Paparazzi","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This image contains a celebrity: {{payload}} !","x":946,"y":408,"wires":[["845630e4.42401"]]},{"id":"ae5f8a6e.2522c8","type":"comment","z":"358f4f87.0edb8","name":"Step #1 - Create a Visual Recognition Service","info":"1. Log into your Bluemix account\n2. Navigate to the Bluemix Catalog\n3. Scroll to the Watson Services section\n4. Find and click on the Visual Recognition service\n5. Create an unbounded Visual Recognition instance\n6. Open the new service and navigate to the Service Credentials\n7. Copy the api_key to the clipboard\n8. Open the above \"visual recognition v3\" node and paste your new API Key","x":406,"y":508,"wires":[]},{"id":"500f0060.fcd18","type":"debug","z":"d7e53ff3.39e67","name":"","active":true,"console":"false","complete":"payload","x":1426,"y":525,"wires":[]},{"id":"dafab6dc.8b27d8","type":"http request","z":"d7e53ff3.39e67","name":"","method":"GET","ret":"txt","url":"http://api.bocapi.net/v1/api/banks/{{bankid}}/accounts/{{accountid}}/{{viewid}}/account","tls":"","x":966.2222137451172,"y":1362.666654586792,"wires":[["40e55b4b.53ca14"]]},{"id":"40e55b4b.53ca14","type":"function","z":"d7e53ff3.39e67","name":"","func":"\nmsg.bank_1_id = msg.payload.accounts.bank_id;\nmsg.account_1_id = msg.payload.accounts.id;\n\nreturn msg;","outputs":1,"noerr":0,"x":964.7656593322754,"y":1413.4061889648438,"wires":[["7c73f227.5ce68c"]]},{"id":"778ae4f5.b2b58c","type":"template","z":"d7e53ff3.39e67","name":"","field":"payload.style","fieldType":"msg","format":"css","syntax":"mustache","template":"body {\n    background-color: #999999;\n}","x":654.0636711120605,"y":1735.6884336471558,"wires":[["59e22b26.0d2c44"]]},{"id":"b13a76da.1b81b8","type":"function","z":"d7e53ff3.39e67","name":"","func":"\nmsg.bank_2_id = msg.payload.accounts.bank_id;\nmsg.account_2_id = msg.payload.accounts.id;\n\nreturn msg;","outputs":1,"noerr":0,"x":1036.6666564941406,"y":1244.222225189209,"wires":[["5d9305bc.29015c"]]},{"id":"16f10b13.1042d5","type":"function","z":"d7e53ff3.39e67","name":"","func":"msg.headers = {\n    \"Content-Type\":\"application/json\",\n    \"Ocp-Apim-Subscription-Key\":\"26150fd04c3c482bb95af58fc47bf462\",\n    \"Auth-Provider-Name\":\"03310909626700\",\n    \"Auth-ID\":\"123456789\"\n    };\nmsg.body = {\n  \"description\": \"transfer\",\n  \"challenge_type\": \"general\",\n  \"from\": {\n    \"account_id\": msg.account_1_id,\n    \"bank_id\": msg.bank_1_id\n  },\n  \"to\": {\n    \"account_id\": msg.account_2_id,\n    \"bank_id\": msg.bank_2_id\n  },\n  \"value\": {\n    \"currency\": msg.payload.currency,\n    \"amount\": msg.payload.ammount\n  }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1155.5555725097656,"y":1512.2222270965576,"wires":[["29bd7195.79563e"]]},{"id":"5d9305bc.29015c","type":"html","z":"d7e53ff3.39e67","name":"","tag":"h2","ret":"html","as":"single","x":1161.1111450195312,"y":1402.22216796875,"wires":[["16f10b13.1042d5"]]},{"id":"7c73f227.5ce68c","type":"html","z":"d7e53ff3.39e67","name":"","tag":"h1","ret":"html","as":"single","x":971.1111259460449,"y":1485.555627822876,"wires":[["16f10b13.1042d5"]]},{"id":"29bd7195.79563e","type":"http response","z":"d7e53ff3.39e67","name":"","x":1291.1110000610352,"y":1574.444275856018,"wires":[]},{"id":"95bc9e7e.a0041","type":"http in","z":"d7e53ff3.39e67","name":"","url":"/mytransfer","method":"get","swaggerDoc":"","x":955.5555419921875,"y":1566.6666259765625,"wires":[["16f10b13.1042d5"]]}]
